<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-width: 300px;
        }

        .section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .preview {
            width: 100%;
            height: 200px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
            margin-bottom: 16px;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        label {
            font-weight: 500;
            font-size: 12px;
            color: #666;
        }

        button {
            background: #18A0FB;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }

        button:hover {
            background: #0D8DE3;
        }

        button:active {
            background: #0B7BC8;
        }

        .button-group {
            display: flex;
            gap: 8px;
        }

        #pixelSize-value {
            font-size: 12px;
            color: #666;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="preview" id="preview">
            <p id="preview-placeholder">Image preview will appear here</p>
            <canvas id="previewCanvas" style="display: none; max-width: 100%; max-height: 100%;"></canvas>
        </div>

        <div class="section">
            <label for="palette">Color Palette</label>
            <select id="palette">
                <option value="nes">NES (52 colors)</option>
                <option value="gameboy">Game Boy (4 colors)</option>
                <option value="snes">SNES (256 colors)</option>
            </select>
        </div>

        <div class="section">
            <label for="pixelSize">Pixel Size</label>
            <input type="range" id="pixelSize" min="2" max="16" value="4">
            <div id="pixelSize-value">4px</div>
        </div>

        <div class="button-group">
            <button id="apply">Apply Effect</button>
            <button id="export">Export PNG</button>
        </div>
    </div>

    <script>
        // Color palettes
        const PALETTES = {
            nes: [
                '#7C7C7C', '#0000FC', '#0000BC', '#4428BC', '#940084', '#A80020', '#A81000', '#881400',
                '#503000', '#007800', '#006800', '#005800', '#004058', '#000000', '#000000', '#000000',
                '#BCBCBC', '#0078F8', '#0058F8', '#6844FC', '#D800CC', '#E40058', '#F83800', '#E45C10',
                '#AC7C00', '#00B800', '#00A800', '#00A844', '#008888', '#000000', '#000000', '#000000',
                '#F8F8F8', '#3CBCFC', '#6888FC', '#9878F8', '#F878F8', '#F85898', '#F87858', '#FCA044',
                '#F8B800', '#B8F818', '#58D854', '#58F898', '#00E8D8', '#787878', '#000000', '#000000',
                '#FCFCFC', '#A4E4FC', '#B8B8F8', '#D8B8F8', '#F8B8F8', '#F8A4C0', '#F0D0B0', '#FCE0A8',
                '#F8D878', '#D8F878', '#B8F8B8', '#B8F8D8', '#00FCFC', '#F8D8F8', '#000000', '#000000'
            ],
            gameboy: ['#0f380f', '#306230', '#8bac0f', '#9bbc0f'],
            snes: [] // We'll generate this programmatically
        };

        // Generate SNES palette (256 colors)
        for (let r = 0; r < 8; r++) {
            for (let g = 0; g < 8; g++) {
                for (let b = 0; b < 4; b++) {
                    PALETTES.snes.push(`rgb(${r * 32},${g * 32},${b * 64})`);
                }
            }
        }

        // UI Elements
        const pixelSizeInput = document.getElementById('pixelSize');
        const pixelSizeValue = document.getElementById('pixelSize-value');
        const paletteSelect = document.getElementById('palette');
        const applyButton = document.getElementById('apply');
        const exportButton = document.getElementById('export');
        const previewCanvas = document.getElementById('previewCanvas');
        const previewPlaceholder = document.getElementById('preview-placeholder');

        // Update pixel size value display
        pixelSizeInput.addEventListener('input', (e) => {
            pixelSizeValue.textContent = `${e.target.value}px`;
            updatePreview();
        });

        // Handle palette changes
        paletteSelect.addEventListener('change', updatePreview);

        // Apply effect button
        applyButton.addEventListener('click', () => {
            parent.postMessage({
                pluginMessage: {
                    type: 'apply-effect',
                    pixelSize: parseInt(pixelSizeInput.value),
                    palette: paletteSelect.value
                }
            }, '*');
        });

        // Export button
        exportButton.addEventListener('click', () => {
            parent.postMessage({
                pluginMessage: {
                    type: 'export-png',
                    pixelSize: parseInt(pixelSizeInput.value),
                    palette: paletteSelect.value
                }
            }, '*');
        });

        // Listen for messages from the plugin code
        window.onmessage = async (event) => {
            const message = event.data.pluginMessage;
            
            if (message.type === 'preview-update') {
                const imageData = message.imageData;
                previewPlaceholder.style.display = 'none';
                previewCanvas.style.display = 'block';
                
                // Update preview canvas
                const ctx = previewCanvas.getContext('2d');
                const img = new Image();
                img.onload = () => {
                    const scale = Math.min(
                        previewCanvas.width / img.width,
                        previewCanvas.height / img.height
                    );
                    const width = img.width * scale;
                    const height = img.height * scale;
                    
                    ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
                    ctx.drawImage(img, 0, 0, width, height);
                };
                img.src = imageData;
            }
        };

        function updatePreview() {
            parent.postMessage({
                pluginMessage: {
                    type: 'update-preview',
                    pixelSize: parseInt(pixelSizeInput.value),
                    palette: paletteSelect.value
                }
            }, '*');
        }
    </script>
</body>
</html> 